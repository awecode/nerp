{% extends "library_base.html" %}
{% load i18n %}
{% load filters %}
{% load staticfiles %}
{% load thumbnail %}

{% block title %} Search{% endblock %}

{% block breadcrumbs %}
    {{ block.super }}
    <li><span> Search</span></li>
{% endblock %}

{% block content %}
    {{ form.errors }}

    <form class="library-search" method="get" action="{% url 'search' %}">
        {#        {% csrf_token %}#}
        {#        <p>#}
        {#            <label for="id_q">Search:</label> <input id="id_q" name="q" value="asd" type="text">#}
        {#            <input type="submit" value="Search!" class="button">#}
        {#        </p>#}

        {{ form.as_p }}

        <input type="submit" value="Search!" class="btn btn-default">

    </form>

    {% if request.GET %}
        {{ form.search.count }} results
        <br>
        <ol class="records">
            {% for item in form.search %}

                {% if item.model_name == 'record' %}
                    <li>
                        {% with item.object as  record %}
                            <div class="row">
                                <div class="col-lg-1 col-md-1 col-sm-1 col-xs-1">
                                    {% if record.get_small_cover %}
                                        <a href="{{ record.get_absolute_url }}">
                                            {#                                            <img src="{{ MEDIA_URL }}{{ record.small_cover }}"></a>#}
                                            {% thumbnail record.get_small_cover "40x60" as im %}
                                                <img src="{{ im.url }}" width="{{ im.width }}" height="{{ im.height }}">
                                            {% endthumbnail %}
                                        </a>
                                    {% else %}
                                        <a href="{{ record.get_absolute_url }}">
                                            <img src="{% static 'img/no_cover-40x60.png' %}"></a>
                                    {% endif %}
                                </div>
                                <div class="col-lg-7 col-md-7 col-sm-7 col-xs-7">
                                    <a href="{{ record.get_absolute_url }}"><h3>{{ record }}</h3></a>
                                    <h5>
                                        {% if record.authors.all %}
                                            by {% for author in record.authors.all %}
                                            {{ author|linkify }}{% if not forloop.last %}, {% endif %}
                                        {% endfor %}
                                        {% endif %}
                                        {% if record.publisher or record.published_date %}
                                            Published
                                            {% if record.published_date %}
                                                {{ record.published_date }}
                                            {% endif %}
                                            {% if record.publisher %}
                                                by {{ record.publisher|linkify }}
                                            {% endif %}
                                        {% endif %}
                                    </h5>
                                </div>
                                <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4">
                                </div>
                            </div>
                        {% endwith %}
                    </li>
                {% else %}
                    <li>
                        {{ item.object|linkify }}
                    </li>
                {% endif %}

                <br/>
            {% endfor %}
        </ol>
    {% endif %}




{% endblock %}