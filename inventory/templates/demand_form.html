{% extends "base.html" %}
{% load i18n %}
{% load filters %}


{% block title %}{% trans scenario %} {% trans 'Demand Form' %}{% endblock %}

{% block breadcrumbs %}
    {{ block.super }}
    <a href="{% url "list_demand_forms" %}">{% trans 'Demand' %}{% trans 'Forms' %}</a>
    <span> {% trans scenario %} {% trans 'Demand Form' %}</span>
{% endblock %}

{% block head_end %}
    <script src="{{ STATIC_URL }}js/base.js"></script>
    <script src="{{ STATIC_URL }}js/vendors/knockout.js"></script>
    <script src="{{ STATIC_URL }}js/ko_lib.js"></script>
    <script src="{{ STATIC_URL }}js/demand_form.js"></script>
    <script>
        ko_data = {{data|jsonify}};
    </script>
{% endblock %}

{% block content %}
    <div class="print-only">
        <span class="right">{% trans 'FCGO' %} {% trans 'F.N.' %} {% trans '4' %}{% trans '5' %}</span>

        <h3 class="center">{{ 'app'|setting:'header' }}</h3>

        <h3 class="center">{% trans 'Demand Form' %}</h3>
    </div>

    <form method="post" enctype="multipart/form-data" data-bind="submit: save">
        {% csrf_token %}

        <div class="one-line row">
    <span class="column large-8">
        &nbsp;
    </span>
    <span class="column large-4">
        {% trans 'Release No.' %}:
        {{ form.release_no }}
        {{ form.release_no.errors }}

    </span>

    <span class="right column large-4 print-only">
        {% trans 'Fiscal Year' %}:
        {{ 'app'|setting:'fiscal_year' }}
    </span>

        </div>

        <div data-bind="with:table_view">

            <table class="table table-bordered">
                <thead>
                <tr>
                    <th class="span1">{% trans 'SN' %}</th>
                    <th class="span2">{% trans 'Item Name' %}</th>
                    <th class="span2">{% trans 'Specification' %}</th>
                    <th class="span3">{% trans 'Item Quantity' %}</th>
                    <th class="span3">{% trans 'Unit' %}</th>
                    <th class="span2">{% trans 'Released Item Quantity' %}</th>
                    <th class="span2">{% trans 'Inventory Account No.' %}</th>
                    <th class="span2">{% trans 'Remarks' %}</th>
                    <th class="span1 hide-on-print"></th>
                </tr>
                </thead>

                <tbody id="tbody">
                <!-- ko foreach: rows -->
                <tr>
                    <td>
                        <span class="wid-pad pull-left" data-bind="text:  $index()+1"> </span>
                    </td>
                    <td>
                        {#                        <select class="span12 item-selector"#}
                        {#                                data-bind="options: $root.items, optionsText: 'name', optionsValue: 'id', value: item_id, optionsCaption: ' ', select2: {},  event: {change: $root.item_changed}"></select>#}
                        <input type="hidden" data-url="{% url 'create_inventory_item' %}" class="change-on-ready"
                               data-bind="value: item_id, select2: $root.items, event: {change: $root.item_changed}, readOnly: status() != 'Requested'">
                    </td>
                    <td data-bind="editableText: specification, disable_content_editable: status() != 'Requested'"></td>
                    <td data-bind="editableText: quantity, numeric: true, disable_content_editable: status() != 'Requested'"></td>
                    <td data-bind="editableText: unit, disable_content_editable: status() != 'Requested'"></td>
                    <td data-bind="editableText: release_quantity, numeric: true, disable_content_editable: status() != 'Requested'"></td>
                    <td data-bind="text: inventory_account_id">2</td>
                    <td data-bind="editableText: remarks"></td>
                    <td class="hide-on-print">
                        <a href="#" class="close tiny secondary" data-bind="click: $parent.removeRow">x</a>
                        <button class="small secondary button"
                                data-bind="click: approve, visible: $root.id() && status() == 'Requested'">Approve
                        </button>
                        <button class="small secondary button"
                                data-bind="click: disapprove, visible: status() == 'Approved'">
                            Disapprove
                        </button>
                        <button class="small secondary button"
                                data-bind="click: function(data, event) { fulfill($root, data, event) }, visible: status() == 'Approved'">Set as
                            Fulfilled
                        </button>
                        <button class="small secondary button"
                                data-bind="click: unfulfill, visible: status() == 'Fulfilled'">Set
                            as Unfulfilled
                        </button>
                    </td>
                </tr>
                <!-- /ko -->
                </tbody>
            </table>
            <a class="small secondary button" data-bind="click: addRow">
                {% trans 'Add New Row' %}
            </a>
        </div>

        <div class="row inline-fields">
            <div class="column large-8">
                <div class="print-only">{% trans "Demandee's Signature" %}:-</div>
                <div>{% trans "Name" %}:- {{ form.instance.demandee }}</div>
                <div>
                    {% trans "Date" %}:-
{#                    {{ form.instance.date|date:"Y-m-d" }}#}
                    {{ form.date }}
                </div>
                <div>{% trans "Purpose" %}:- {{ form.purpose }}</div>
                <div class="print-only">{% trans "Signature of the one who enters in Inventory Account" %}:-</div>
                <div class="print-only">{% trans "Date" %}:-</div>
            </div>

            <div class="column large-8">
                <div>{% trans "(a)" %} {% trans "Buy from market" %}</div>
                <div>{% trans "(b)" %} {% trans "Lend from store" %}</div>
                <div class="print-only">{% trans "Signature of the orderer" %}:-</div>
                <div class="print-only">{% trans "Date" %}:-</div>
                <div class="print-only">{% trans "Signature of the receiver" %}:-</div>
                <div class="print-only">{% trans "Date" %}:-</div>
            </div>
        </div>

        <br/>

        <input type="submit" class="small secondary button" value="{% trans 'Save' %}"
                {#               data-bind="visible: $root.status() == 'Requested'"#}
                >
        {% if scenario == 'Update'%}
            <a class="small secondary button"
               href="{% url 'delete_demand_form' form.instance.id %}">{% trans 'Delete!' %}</a>
        {% endif %}

    </form>

{% endblock %}